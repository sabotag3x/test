<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>IMDb / Letterboxd – Filmes Avaliados</title>

<style>
body {
  background:#000;
  color:#fff;
  font-family:Arial;
  padding:40px;
}
input, select, button {
  padding:10px;
  font-size:16px;
}
button {
  cursor:pointer;
}
#status {
  margin-top:15px;
  color:#ffcc00;
  font-size:18px;
}
table {
  margin-top:20px;
  width:100%;
  border-collapse:collapse;
}
th, td {
  border:1px solid #444;
  padding:6px;
}
</style>
</head>

<body>

<h2>Buscar filmes avaliados</h2>

<select id="source">
  <option value="imdb">IMDb</option>
  <option value="letterboxd">Letterboxd</option>
</select>

<input id="userId" placeholder="urXXXX ou username">
<button onclick="buscar()">Buscar</button>

<div id="status">Aguardando…</div>

<table id="table" style="display:none">
<thead>
<tr>
  <th>#</th>
  <th>Filme</th>
  <th>Ano</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
async function buscar() {
  const source = document.getElementById("source").value;
  const user   = document.getElementById("userId").value.trim();
  const status = document.getElementById("status");
  const table  = document.getElementById("table");
  const tbody  = table.querySelector("tbody");

  if (!user) return;

  status.textContent = "Buscando…";
  table.style.display = "none";
  tbody.innerHTML = "";

  const res = await fetch(`/api/${source}/${user}`);
  const data = await res.json();

  if (!Array.isArray(data) || data.length === 0) {
    status.textContent = "Nenhum resultado";
    return;
  }

  data.forEach(m => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${m.index}</td><td>${m.title}</td><td>${m.year}</td>`;
    tbody.appendChild(tr);
  });

  table.style.display = "table";
  status.textContent = `Encontrados ${data.length} filmes`;
}
</script>

</body>
</html>
