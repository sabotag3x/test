<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Batalha de Filmes â€“ IMDb Top 250</title>

<style>
body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  background:#000;
  color:#fff;
  font-family:Arial, sans-serif;
}
.container{
  max-width:1600px;
  width:100%;
  padding:40px;
  text-align:center;
}
h1{margin-bottom:20px}

#startBtn{
  background:#ffcc00;
  color:#000;
  font-size:20px;
  font-weight:bold;
  padding:14px 36px;
  border-radius:40px;
  border:none;
  cursor:pointer;
  margin-bottom:40px;
}

.bracket{
  display:grid;
  grid-template-columns: repeat(9, auto);
  align-items:center;
  justify-content:center;
  gap:30px;
}

.column{
  display:flex;
  flex-direction:column;
  gap:20px;
}

.card.small{width:90px}
.card.medium{width:130px}
.card.large{width:180px}
.card.champion{width:300px}

.card img{
  width:100%;
  border-radius:8px;
}

.title{
  font-size:14px;
  margin-top:6px;
}
</style>
</head>

<body>
<div class="container">
  <h1>Batalha de Filmes â€“ IMDb Top 250</h1>
  <button id="startBtn">ðŸŽ¬ Gerar competiÃ§Ã£o</button>
  <div id="duel"></div>
</div>

<script>
let filmes=[], atual=[], vencedores=[];
let rounds=[];

async function start(){
  const res = await fetch("/api/films?ts="+Date.now());
  const data = await res.json();
  filmes = shuffle(data.films).slice(0,16);
  rounds = [filmes];
  playRound(filmes);
}

function shuffle(a){
  const b=[...a];
  for(let i=b.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [b[i],b[j]]=[b[j],b[i]];
  }
  return b;
}

function playRound(list){
  if(list.length===1){
    renderBracket();
    return;
  }
  vencedores=[];
  for(let i=0;i<list.length;i+=2){
    vencedores.push(list[i]); // vencedor automÃ¡tico (demo)
  }
  rounds.push(vencedores);
  playRound(vencedores);
}

function renderBracket(){
  const duel=document.getElementById("duel");

  const leftRounds = rounds.slice(0,3);
  const rightRounds = rounds.slice(0,3).map(r=>[...r].reverse());
  const champion = rounds[rounds.length-1][0];

  let html = `<div class="bracket">`;

  leftRounds.forEach((r,i)=>{
    html+=`<div class="column">`;
    r.forEach(f=>html+=card(f,i));
    html+=`</div>`;
  });

  html+=`
    <div class="column">
      <div class="card champion">
        <img src="${champion.poster}">
        <div class="title">CampeÃ£o<br>${champion.title} (${champion.year})</div>
      </div>
    </div>
  `;

  rightRounds.reverse().forEach((r,i)=>{
    html+=`<div class="column">`;
    r.forEach(f=>html+=card(f,2-i));
    html+=`</div>`;
  });

  html+=`</div>`;
  duel.innerHTML=html;
}

function card(f,stage){
  const size = stage===0?"small":stage===1?"medium":"large";
  return `
    <div class="card ${size}">
      <img src="${f.poster}">
      <div class="title">${f.title}</div>
    </div>
  `;
}

document.getElementById("startBtn").onclick=start;
</script>
</body>
</html>
